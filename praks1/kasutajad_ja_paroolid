#!/bin/bash
# kasutajad_ja_paroolid - loeb alati failidest "kasutajad" ja "paroolid" ning seob need realt-reale
# Failides peab olema sama arv ridu; iga rida vastab kasutajale/paroolile.
# Kasutus: sudo ./kasutajad_ja_paroolid

set -euo pipefail

if [ "$EUID" -ne 0 ]; then
  echo "Käivita root'i õigustes (nt: sudo ./kasutajad_ja_paroolid)."
  exit 1
fi

KAS_FAIL="kasutajad"
PAR_FAIL="paroolid"

if [ ! -f "$KAS_FAIL" ] || [ ! -f "$PAR_FAIL" ]; then
  echo "Failid '$KAS_FAIL' või '$PAR_FAIL' puuduvad. Palun lisa need."
  exit 1
fi

# paste tagab, et paarime read; kui read erinevad, jäävad tühjad välja
paste "$KAS_FAIL" "$PAR_FAIL" | while IFS=$'\t' read -r kasutaja parool; do
  kasutaja=$(printf "%s" "$kasutaja" | tr -d '\r\n')
  parool=$(printf "%s" "$parool"   | tr -d '\r\n')
  [ -z "$kasutaja" ] && continue

  if id "$kasutaja" &>/dev/null; then
    echo "Kasutaja '$kasutaja' juba olemas — uuendan parooli."
  else
    useradd -m -s /bin/bash "$kasutaja"
    echo "Loodud kasutaja $kasutaja"
  fi

  echo "$kasutaja:$parool" | chpasswd
  echo "Seatud parool kasutajale $kasutaja"
done

echo "Valmis: kasutajad ja paroolid failidest '$KAS_FAIL' + '$PAR_FAIL' töödeldud."
